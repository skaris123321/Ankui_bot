const { SlashCommandBuilder, EmbedBuilder, PermissionFlagsBits } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('rules')
    .setDescription('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞')
    .addChannelOption(option =>
      option.setName('–∫–∞–Ω–∞–ª')
        .setDescription('–ö–∞–Ω–∞–ª –¥–ª—è –ø—Ä–∞–≤–∏–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Ç–µ–∫—É—â–∏–π)')
        .setRequired(false))
    .setDefaultMemberPermissions(PermissionFlagsBits.Administrator),
  
  async execute(interaction, client) {
    const targetChannel = interaction.options.getChannel('–∫–∞–Ω–∞–ª') || interaction.channel;
    const guildId = interaction.guild.id;
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    const settings = client.db.getGuildSettings(guildId) || {};
    const rulesText = settings.rules_text || this.getDefaultRules();
    
    try {
      const embed = new EmbedBuilder()
        .setColor('#5865F2')
        .setTitle(`üìú –ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞ ${interaction.guild.name}`)
        .setDescription(rulesText)
        .setThumbnail(interaction.guild.iconURL({ dynamic: true }))
        .setTimestamp()
        .setFooter({ 
          text: `–û–±–Ω–æ–≤–ª–µ–Ω–æ ${interaction.user.username}`,
          iconURL: interaction.user.displayAvatarURL()
        });
      
      await targetChannel.send({ embeds: [embed] });
      
      await interaction.reply({ 
        content: `‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ ${targetChannel}!`, 
        ephemeral: true 
      });
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∞–≤–∏–ª:', error);
      await interaction.reply({ 
        content: '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∞–≤–∏–ª!', 
        ephemeral: true 
      });
    }
  },
  
  getDefaultRules() {
    return `**1. –£–≤–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ:** –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫–æ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —Å —É–≤–∞–∂–µ–Ω–∏–µ–º. –ó–∞–ø—Ä–µ—â–µ–Ω—ã –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, —É–≥—Ä–æ–∑—ã, –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–∏ –∏ –ª—é–±–∞—è —Ñ–æ—Ä–º–∞ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏–∏.

**2. –ó–∞–ø—Ä–µ—â–µ–Ω—ã —á–∏—Ç—ã –∏ –ª—é–±—ã–µ –Ω–µ—á–µ—Å—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:** –õ—é–±–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–∏—Ç–æ–≤, –±–∞–≥–æ–≤ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ–±–º–∞–Ω–∞ —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ.

**3. –ë–µ–∑ —Å–ø–∞–º–∞:** –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–∏–º–≤–æ–ª–æ–≤, —Å–ø–∞–º–æ–º, —Ñ–ª—É–¥–æ–º, —Ä–µ–∫–ª–∞–º–æ–π –∏–ª–∏ –Ω–µ–Ω—É–∂–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.

**4. –°–æ–±–ª—é–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –∫–∞–Ω–∞–ª–∞:** –ö–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª –∏–º–µ–µ—Ç —Å–≤–æ—ë –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±—Å—É–∂–¥–∞–π—Ç–µ —Ç–∞–∫—Ç–∏–∫–∏ –≤ –∫–∞–Ω–∞–ª–µ –¥–ª—è —Ç–∞–∫—Ç–∏–∫, –∞ –Ω–µ –≤ –æ–±—â–µ–º —á–∞—Ç–µ.

**5. –ó–∞–ø—Ä–µ—â–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–∞:** –ë–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã, –≤–∫–ª—é—á–∞—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–µ—Ä—ã, –ø—Ä–æ–¥—É–∫—Ç—ã, —É—Å–ª—É–≥–∏ –∏ —Ç.–¥.

**6. –ù–µ –æ–±—Å—É–∂–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∏ —Ä–µ–ª–∏–≥–∏—é:** –≠—Ç–∏ —Ç–µ–º—ã —á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –Ω–µ—á–µ—Å—Ç–Ω—ã –Ω–∞ –Ω–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ.

**7. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:** –û–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ ‚Äî –æ–¥–Ω–∞ —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–ª—å—Ç-–∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –æ–±—Ö–æ–¥–∞ –Ω–∞–∫–∞–∑–∞–Ω–∏–π –∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π.

**8. –°–ª—É—à–∞–π—Ç–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤:** –†–µ—à–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ —è–≤–ª—è—é—Ç—Å—è –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–º–∏. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∂–∞–ª–æ–±—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –Ω–∏–º –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

**9. –°–æ–æ–±—â–∞–π—Ç–µ –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö:** –ï—Å–ª–∏ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª, —Å–æ–æ–±—â–∏—Ç–µ –æ–± —ç—Ç–æ–º –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.`;
  }
};

