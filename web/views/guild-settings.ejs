<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('partials/header') %>
  
  <main class="guild-settings">
    <div class="container">
      <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞</h1>
      <p class="guild-id">ID —Å–µ—Ä–≤–µ—Ä–∞: <code><%= guildId %></code></p>
      
      <div class="settings-tabs">
        <button class="tab-btn active" onclick="showTab('rules')">üìú –ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞</button>
        <button class="tab-btn" onclick="showTab('embed')">üé® –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
      </div>
      
      <form id="settingsForm">
        <!-- –í–∫–ª–∞–¥–∫–∞: –ü—Ä–∞–≤–∏–ª–∞ -->
        <div class="tab-content active" id="rules-tab">
          <h2>üìú –ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞</h2>
          <p class="info-message">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–∞–≤–∏–ª, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–º–∞–Ω–¥–æ–π <strong>/rules</strong></p>
          
          <div class="setting-group">
            <label>–¢–µ–∫—Å—Ç –ø—Ä–∞–≤–∏–ª:</label>
            <textarea name="rules_text" class="textarea-field" rows="20" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."><%= settings.rules_text || '' %></textarea>
            <small>üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç** –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</small>
          </div>
          
          <div class="info-box">
            <h3>üìù –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h3>
            <ol>
              <li>–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–∞–≤–∏–ª –≤—ã—à–µ</li>
              <li>–ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"</li>
              <li>–í Discord –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/rules</code> —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ –∫–∞–Ω–∞–ª</li>
            </ol>
          </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞: –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ -->
        <div class="tab-content" id="embed-tab">
          <h2>üé® –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
          <p class="info-message">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É <strong>/embed</strong> –≤ Discord –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</p>
          
          <div class="info-box">
            <h3>üé® –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏ –∫–æ–º–∞–Ω–¥—ã /embed:</h3>
            <ul>
              <li><strong>–ó–∞–≥–æ–ª–æ–≤–æ–∫</strong> - –ì–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</li>
              <li><strong>–¢–µ–∫—Å—Ç</strong> - –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</li>
              <li><strong>–¶–≤–µ—Ç</strong> - –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç —Ä–∞–º–∫–∏ (—Å–∏–Ω–∏–π, –∑–µ–ª—ë–Ω—ã–π, –∫—Ä–∞—Å–Ω—ã–π –∏ —Ç.–¥.)</li>
              <li><strong>–ö–∞—Ä—Ç–∏–Ω–∫–∞</strong> - URL –±–æ–ª—å—à–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤–Ω–∏–∑—É —Å–æ–æ–±—â–µ–Ω–∏—è</li>
              <li><strong>–ú–∏–Ω–∏–∞—Ç—é—Ä–∞</strong> - URL –º–∞–ª–µ–Ω—å–∫–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å–ø—Ä–∞–≤–∞</li>
              <li><strong>–ö–∞–Ω–∞–ª</strong> - –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</li>
            </ul>
          </div>
          
          <div class="commands-list">
            <div class="command-item">
              <strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong><br>
              <code>/embed –∑–∞–≥–æ–ª–æ–≤–æ–∫:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!" —Ç–µ–∫—Å—Ç:"–ü—Ä–∏–≤–µ—Ç –Ω–∞ –Ω–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ!" —Ü–≤–µ—Ç:–°–∏–Ω–∏–π</code>
            </div>
          </div>
          
          <div class="info-box">
            <h3>üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:</h3>
            <ul>
              <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–∂–∏—Ä–Ω—ã–π** –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∂–∏—Ä–Ω—ã–º</li>
              <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ *–∫—É—Ä—Å–∏–≤* –¥–ª—è –∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞</li>
              <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ~~–∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π~~ –¥–ª—è –∑–∞—á—ë—Ä–∫–Ω—É—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞</li>
              <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `–∫–æ–¥` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–¥–∞</li>
              <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ > –¥–ª—è —Ü–∏—Ç–∞—Ç</li>
            </ul>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
          <button type="button" onclick="resetForm()" class="btn btn-secondary">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
      </form>
      
      <div id="saveMessage" class="save-message"></div>
    </div>
  </main>
  
  <%- include('partials/footer') %>
  
  <script>
    const guildId = '<%= guildId %>';
    
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName + '-tab').classList.add('active');
      event.target.classList.add('active');
    }
    
    document.getElementById('settingsForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const settings = {};
      
      for (const [key, value] of formData.entries()) {
        if (key.includes('enabled')) {
          settings[key] = 1;
        } else {
          settings[key] = value;
        }
      }
      
      // Handle unchecked checkboxes
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        if (!checkbox.checked) {
          settings[checkbox.name] = 0;
        }
      });
      
      try {
        const response = await fetch(`/api/guild/${guildId}/settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(settings)
        });
        
        const result = await response.json();
        
        const messageDiv = document.getElementById('saveMessage');
        if (result.success) {
          messageDiv.textContent = '‚úÖ ' + result.message;
          messageDiv.className = 'save-message success';
        } else {
          messageDiv.textContent = '‚ùå ' + result.message;
          messageDiv.className = 'save-message error';
        }
        
        messageDiv.style.display = 'block';
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 3000);
      } catch (error) {
        console.error('Error:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫');
      }
    });
    
    function resetForm() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è?')) {
        location.reload();
      }
    }
  </script>
</body>
</html>

